<div class="container-fluid">
  <!-- Encabezado estilo Gestión de Usuarios -->
  <div class="row mb-4">
    <div class="col-12">
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="#">Home</a></li>
          <li class="breadcrumb-item active">Gestión de pacientes</li>
        </ol>
      </nav>
      <h2 class="page-title">Gestión de pacientes</h2>
    </div>
  </div>

  <!-- Sección "Mis pacientes" con botón a la derecha -->
  <div class="row mb-3">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center">
        <h4 class="section-title">Mis pacientes</h4>
        <button class="btn btn-primary btn-sm" (click)="nuevoPaciente()">
          <i class="fas fa-plus me-1"></i> Nuevo Paciente
        </button>
      </div>
    </div>
  </div>

  <!-- Tabla estilo limpio -->
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-hover mb-0">
              <thead class="table-light">
                <tr>
                  <th class="border-0">ID</th>
                  <th class="border-0">Documento</th>
                  <th class="border-0">Nombres</th>
                  <th class="border-0">Apellidos</th>
                  <th class="border-0">Teléfono</th>
                  <th class="border-0">Email</th>
                  <th class="border-0">Edad</th>
                  <th class="border-0">Estado</th>
                  <th class="border-0">Acciones</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let paciente of pacientes">
                  <td class="fw-semibold">{{ paciente.id }}</td>
                  <td>
                    <small class="text-muted">{{ paciente.tipoDocumento }}</small><br>
                    {{ paciente.numeroDocumento }}
                  </td>
                  <td>{{ paciente.nombres }}</td>
                  <td>{{ paciente.apellidos }}</td>
                  <td>{{ paciente.telefono }}</td>
                  <td>
                    <small class="text-truncate" style="max-width: 150px; display: inline-block;">
                      {{ paciente.email }}
                    </small>
                  </td>
                  <td>
                    <span class="badge bg-info text-white">
                      {{ calcularEdad(paciente.fechaNacimiento) }} años
                    </span>
                  </td>
                  <td>
                    <span class="badge" 
                          [class.bg-success]="paciente.estado === 'Activo'"
                          [class.bg-secondary]="paciente.estado === 'Inactivo'"
                          [class.bg-warning]="paciente.estado !== 'Activo' && paciente.estado !== 'Inactivo'">
                      {{ paciente.estado }}
                    </span>
                  </td>
                  <td>
                    <div class="btn-group btn-group-sm" role="group">
                      <button class="btn btn-outline-primary" 
                              (click)="editarPaciente(paciente)"
                              title="Editar paciente">
                        <i class="fas fa-edit"></i>
                      </button>
                      <button class="btn btn-outline-danger" 
                              (click)="eliminarPaciente(paciente.id)"
                              title="Eliminar paciente">
                        <i class="fas fa-trash"></i>
                      </button>
                    </div>
                  </td>
                </tr>
                <tr *ngIf="pacientes.length === 0">
                  <td colspan="9" class="text-center py-4">
                    <div class="text-muted">
                      <i class="fas fa-user-injured fa-2x mb-2"></i>
                      <p class="mb-0">No hay pacientes registrados</p>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal para Nuevo/Editar Paciente -->
  <div *ngIf="mostrarFormulario" class="modal fade show d-block" 
       style="background-color: rgba(0,0,0,0.5)" 
       tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">
            {{ pacienteSeleccionado.id ? 'Editar Paciente' : 'Nuevo Paciente' }}
          </h5>
          <button type="button" class="btn-close" (click)="cancelar()" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Nombres *</label>
              <input type="text" class="form-control" 
                     [(ngModel)]="pacienteSeleccionado.nombres" 
                     placeholder="Ingrese los nombres" name="nombres" required>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Apellidos *</label>
              <input type="text" class="form-control" 
                     [(ngModel)]="pacienteSeleccionado.apellidos" 
                     placeholder="Ingrese los apellidos" name="apellidos" required>
            </div>
            <div class="col-md-4 mb-3">
              <label class="form-label">Tipo Documento *</label>
              <select class="form-control" [(ngModel)]="pacienteSeleccionado.tipoDocumento" name="tipoDocumento" required>
                <option value="">Seleccione...</option>
                <option value="CC">Cédula de Ciudadanía</option>
                <option value="CE">Cédula de Extranjería</option>
                <option value="PA">Pasaporte</option>
                <option value="TI">Tarjeta de Identidad</option>
              </select>
            </div>
            <div class="col-md-4 mb-3">
              <label class="form-label">Número Documento *</label>
              <input type="text" class="form-control" 
                     [(ngModel)]="pacienteSeleccionado.numeroDocumento" 
                     placeholder="Número de documento" name="numeroDocumento" required>
            </div>
            <div class="col-md-4 mb-3">
              <label class="form-label">Género</label>
              <select class="form-control" [(ngModel)]="pacienteSeleccionado.genero" name="genero">
                <option value="">Seleccione...</option>
                <option value="Masculino">Masculino</option>
                <option value="Femenino">Femenino</option>
                <option value="Otro">Otro</option>
              </select>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Teléfono</label>
              <input type="text" class="form-control" 
                     [(ngModel)]="pacienteSeleccionado.telefono" 
                     placeholder="Número de teléfono" name="telefono">
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Email</label>
              <input type="email" class="form-control" 
                     [(ngModel)]="pacienteSeleccionado.email" 
                     placeholder="correo@ejemplo.com" name="email">
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Fecha de Nacimiento</label>
              <input type="date" class="form-control" 
                     [(ngModel)]="pacienteSeleccionado.fechaNacimiento" 
                     name="fechaNacimiento">
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Estado</label>
              <select class="form-control" [(ngModel)]="pacienteSeleccionado.estado" name="estado">
                <option value="Activo">Activo</option>
                <option value="Inactivo">Inactivo</option>
              </select>
            </div>
            <div class="col-12 mb-3">
              <label class="form-label">Dirección</label>
              <textarea class="form-control" 
                        [(ngModel)]="pacienteSeleccionado.direccion" 
                        placeholder="Dirección completa" 
                        name="direccion"
                        rows="2"></textarea>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="cancelar()">
            <i class="fas fa-times me-1"></i> Cancelar
          </button>
          <button type="button" class="btn btn-primary" (click)="guardarPaciente()" 
                  [disabled]="!pacienteSeleccionado.nombres || !pacienteSeleccionado.apellidos || !pacienteSeleccionado.tipoDocumento || !pacienteSeleccionado.numeroDocumento">
            <i class="fas fa-save me-1"></i> Guardar
          </button>
        </div>
      </div>
    </div>
  </div>
</div>