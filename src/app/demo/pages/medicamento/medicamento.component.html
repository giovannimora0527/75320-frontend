<ngx-spinner type="pacman" size="medium">
    <p style="color: white">{{ titleSpinner }}</p>
</ngx-spinner>

<div class="container">
    <div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h3><i class="fa fa-capsules"></i> &nbsp;Medicamentos</h3>
        <button class="btn btn-outline-primary" (click)="abrirNuevoMedicamento()">Nuevo Medicamento</button>
    </div>

    <div class="card-body">

        <!--  FILTROS -->
        <div class="bg-light border rounded p-3 mb-4">
        <div class="row g-3 align-items-center">
            <div class="col-md-6">
            <div class="input-group">
                <span class="input-group-text bg-white border-end-0">
                <i class="fa fa-search text-muted"></i>
                </span>
                <input
                type="text"
                class="form-control border-start-0"
                placeholder="Buscar por nombre o descripción..."
                [(ngModel)]="filtroBusqueda"
                (ngModelChange)="aplicarFiltros()"
                />
            </div>
            </div>

            <div class="col-md-3">
            <select class="form-select" [(ngModel)]="filtroEstado" (ngModelChange)="aplicarFiltros()">
                <option value="">Todos los estados</option>
                <option value="vigente">Vigente</option>
                <option value="vencido">Vencido</option>
            </select>
            </div>

            <div class="col-md-3">
            <input
                type="date"
                class="form-control"
                [(ngModel)]="filtroFecha"
                (ngModelChange)="aplicarFiltros()"
            />
            </div>
        </div>
        </div>

        <!-- TABLA -->
        <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead>
            <tr>
                <th>Id</th>
                <th>Nombre</th>
                <th>Descripción</th>
                <th>Presentación</th>
                <th>Fecha Compra</th>
                <th>Fecha Vencimiento</th>
                <th>Creacion de Registro</th>
                <th>Modificacion deRegistro</th>
                <th>Acciones</th>
            </tr>
            </thead>

          <tbody *ngIf="medicamentoListFiltrada.length === 0">
            <tr class="text-center">
                <td colspan="9">No hay medicamentos registrados</td>
            </tr>
            </tbody>

          <tbody *ngIf="medicamentoListFiltrada.length > 0">
            <tr *ngFor="let medicamento of medicamentoListFiltrada">
                <td>{{ medicamento.id }}</td>
                <td>{{ medicamento.nombre }}</td>
                <td>{{ medicamento.descripcion }}</td>
                <td>{{ medicamento.presentacion }}</td>
                <td>{{ medicamento.fechaCompra | date: 'shortDate' }}</td>
                <td>{{ medicamento.fechaVence | date: 'shortDate' }}</td>
                <td>{{ medicamento.fechaCreacionRegistro | date: 'shortDate' }}</td>
                <td>{{ medicamento.fechaModificacionRegistro | date: 'shortDate' }}</td>
                <td>
                <button
                    class="btn btn-sm btn-outline-primary"
                    (click)="abrirEditarMedicamento(medicamento)"
                >
                    <i class="fa fa-edit"></i>    
                    &nbsp;Editar
                </button>
                </td>
            </tr>
            </tbody>
        </table>
        </div>
    </div>
    </div>
</div>

<!-- MODAL -->
<div
    class="modal fade"
    id="modalCrearMedicamento"
    tabindex="-1"
    aria-labelledby="modalCrearMedicamentoModalLabel"
    aria-hidden="true"
    >
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content">
        <div class="modal-header">
            <h1 class="modal-title fs-5">{{ titleModal }}</h1>
            <button type="button" class="btn-close" (click)="closeModal()"></button>
        </div>
        <div class="modal-body">
            <form [formGroup]="form">
            <div class="mb-3">
                <label>Nombre</label>
                <input
                formControlName="nombre"
                class="form-control"
                placeholder="Ingrese el nombre del medicamento"
                [ngModel]="medicamentoSelected ? medicamentoSelected.nombre : ''"
                />
            </div>

            <div class="mb-3">
                <label>Descripción</label>
                <textarea
                formControlName="descripcion"
                class="form-control"
                placeholder="Breve descripción del medicamento"
                [ngModel]="medicamentoSelected ? medicamentoSelected.descripcion : ''"
                ></textarea>
            </div>

            <div class="mb-3">
                <label>Presentación</label>
                <input
                formControlName="presentacion"
                class="form-control"
                placeholder="Ejemplo: Caja x 10 tabletas"
                [ngModel]="medicamentoSelected ? medicamentoSelected.presentacion : ''"
                />
            </div>

            <div class="mb-3">
                <label>Fecha de vencimiento</label>
                <input formControlName="fechaVence" type="date" class="form-control" />
            </div>

            </form>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" (click)="closeModal()">Cerrar</button>
            <button class="btn btn-primary" (click)="guardarMedicamento()">
            {{ titleBoton }}
            </button>
        </div>
        </div>
    </div>
</div>
